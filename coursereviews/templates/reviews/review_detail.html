{% extends 'reviews/base.html' %}
{% load compressed %}
{% load static from staticfiles %}

{% block js %}
  <script src="{% static 'coursereviews/js/select2.min.js' %}"></script>
  <script src="{% static 'reviews/js/d3.v3.min.js' %}"></script>
  {% compressed_js 'review_detail' %}
{% endblock %}

{% block content %}
  {% if type == 'course' %}
  <h2 class="review-title">
    {{ course.title }}&nbsp;
    <small>{{course.code}}</small>
  </h2>
  <h4><a href="{{ course.dept.get_absolute_url }}">{{ course.dept }}</a></h4>
  <p>{{ course.description }}</p>
  <span class="h4">
    See this course with
    {% for prof_course in prof_courses %}
    <a href="{{ prof_course.get_absolute_url }}">{{ prof_course.prof }}</a>{% if not forloop.last %},{% endif %}
    {% endfor %}
  </span>

  {% elif type == 'prof' %}
  <h2 class="review-title">
    {{ prof }}&nbsp;
    {% if prof.email %}
    <small><a href="mailto:{{ prof.email }}">{{ prof.email }}</a></small>
    {% endif %}
  </h2>
  <h4><a href="{{ prof.dept.get_absolute_url }}">{{ prof.dept }}</a></h4>
  {% if prof_courses %}
  <span class="h4">
    See {{ prof }}'s reviews for
    {% for prof_course in prof_courses %}
    <a href="{{ prof_course.get_absolute_url }}">{{ prof_course.course.title }}</a>{% if not forloop.last %},{% endif %}
    {% endfor %}
  </span>
  {% endif %}

  {% else %}
  <h2 class="review-title">
    {{ prof_course.course.title }}&nbsp;
    <small>
      <a href="{{ prof_course.course.get_absolute_url }}">{{ prof_course.course.code }}</a>&nbsp;&mdash;
      <a href="{{ prof_course.prof.get_absolute_url }}">{{ prof_course.prof }}</a>
    </small>
  </h2>
  <h4><a href="{{ prof_course.course.dept.get_absolute_url }}">{{ prof_course.course.dept }}</a></h4>
  <p>{{ prof_course.course.description }}</p>
  {% endif %}

  <div id="review-body">
    <div class="row">
      <div class="col-md-6" id="stats-container"></div>
      <div class="col-md-6">
        {% if reviews %}
        <h4>Comments<small class="pull-right">sorted by most valuable</small></h4>
        <div class="comments">
          {% for review in reviews %}
            {% if review.comment %}
            <div class="comment">
            <table>
            <tbody>
              <tr>
                <td class="comment-voting" data-comment-id="{{ review.id }}">
                  <span class="glyphicon glyphicon-arrow-up upvote{% if request.user in review.up_votes.all %} upvote-highlight{% endif %}"></span>
                  <span class="glyphicon glyphicon-arrow-down downvote{% if request.user in review.down_votes.all %} downvote-highlight{% endif %}"></span>
                </td>
                <td class="comment-body">
                  {{ review.comment }}
                  {% if type == 'prof' %}
                  <i class="comment-context">Course: <a href="{{ review.prof_course.course.get_absolute_url }}">{{ review.prof_course.course.code }}</a>
                  {% elif type == 'course' %}
                  <i class="comment-context">Professor: <a href="{{ review.prof_course.prof.get_absolute_url }}">{{ review.prof_course.prof }}</a></i>
                  {% endif %}
                </td>
              </tr>
            </tbody>
            </table>
            </div>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}